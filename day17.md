# day17 

掌握宏！

可以录制一系列动作，类似代码中的函数，录制后就可使用它

- 开始录制：`q` + 寄存器名字（如 `qa`
- 结束录制：`q`
- 查看录制好的宏：`:reg ` + 寄存器名字，如`:reg a`
- 使用：`@` + 寄存器名字，如`@a` 
- 使用最后一次执行的宏：`@@`, 显然比`@a`快一些
- 重复执行：`10@a`, 执行10次`@a`
- 安全机制：出错后就停止


## 练习

将下面的每个点改成`)`，同时把每个单词首字母大写

1. one
2. two
3. three
4. four
5. five

### 入手

1. 如上，我们输入`qa`进入录制
2. 光标定位到第一行
3. 键入`0`, 定位到行首
4. 键入`f.` + 回车，定位到`.` (前面我们改建了，vim-sneak改成`f`, 因为他是输入两个字符，因此这里只搜一个字符.的话，需要加回车键)
5. 键入`r` + `)`进行替换
6. 键入`w`定位下一个单词首位
7. 键入`~`, 更改为大写（这里用`vU`感觉更好，如果有些单词已经是一开始是大写了
8. 键入`j`, 跑到下一行
9. `q`, 结束录制
10. 这时候，第一行已经改过来了，接下来我们连续使用`@a`或`@@`或`4@a`（当然得确保你清楚要修改的数量）

然后你就得到如下的内容了：

1) One
2) Two
3) Three
4) Four
5) Five

## 安全机制

执行宏时，如果出现错误就会退出，例如我们执行的宏里面有搜索命令，当搜索不到时，就会报错。

例如我们搜索替换文本中的`test`改成`hello`

1. `/test`, 回车
2. `qa`
3. `ciw` + hello
4. `n`
5. `q` 结束录制
6. 假设要替换的很多个时，我们没必要数到底要替换几个，可以直接`100@@`, 然后当他找不到下一个的时候，自然就会结束了

> 这里只是举个例子，这种情况直接用之前学的 `:%s/test/hello/g`更快

```
hello
hello
hello
hello
```

## 追加

`qA`: 如果之前录制的宏时`a`

例如上面的练习，我们录制完后，发现少了第八步（移动到下一行），这时候可以执行`qA`, 再加上`j`, 再`q`退出录制即可

使用`:ref a`查看发现添加了`j`

1. one
2. TWO
3. THREE
4. FOUR
5. FIVE

## 修改一个已知的宏

修改寄存器里的内容

1. 取出来
   1. `"` + 寄存器名字 + `p`: 如`"ap`
   2. `:put a`
2. 会将执行的命令复制到文本中
3. 修改复制出来的命令
4. `"ayy` 或 `"aw` 即可把修改宏

如我们录制一个宏来讲单词小写: `0wwguiwj`

然后拿出来后，再改成 `0wwgUiwj`, 执行`:ayy`, 然后查看`:reg a`，可以看到已经修改了

> 但是`vscode`的`vim`插件有bug，修改后的宏无法生效

我们可以在终端中尝试下，`vim day17.md`

当然我们很少会使用到修改，所有其实也还好

## 技巧

- 规范好光标位置，例如上面的练习，最后一步使用`j`跳到下一行
- 移动的时候使用相对位置
  - 例如`w`, `e`等相对定位 如上面的练习，我们使用`0`跳到首列，`f.`定位到`.`, `w`定位到单词
  - 避免使用绝对定位，如`hjkl`, 如上如果每行定位`.`的话使用`l`, 那么当前面的数字的位数不同，那就没法其效果了


工作中，一些比较复杂的重复性的修改，可能就可以使用到宏了